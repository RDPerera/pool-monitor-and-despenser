# System Wiring Diagram

```
                              ESP32 POOL CHEMICAL DISPENSER
                              ============================

┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                            ESP32 DEV BOARD                              │
│                                                                         │
│   ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐              │
│   │ 3V3 │  │ GND │  │ D16 │  │ D17 │  │ D25 │  │ D33 │  ...         │
│   └──┬──┘  └──┬──┘  └──┬──┘  └──┬──┘  └──┬──┘  └──┬──┘              │
│      │        │        │        │        │        │                    │
└──────┼────────┼────────┼────────┼────────┼────────┼────────────────────┘
       │        │        │        │        │        │
       │        │        │        │        │        │
       │        │      [220Ω]     │        │        │
       │        │        │        │        │        │
       │        │        ▼        │        │        │
       │        │      ┌───┐      │        │        │
       │        │      │LED│      │        │        │
       │        │      └─┬─┘      │        │        │
       │        │        │        │        │        │
       │        └────────┴────────┘        │        │
       │                 │                 │        │
       │               ┌─┴─┐               │        │
       │               │GND│               │        │
       │               └───┘               │        │
       │                                   │        │
       │            [BUTTON]               │        │
       │            (SPST N.O.)            │        │
       │                 │                 │        │
       │                 ├─────────────────┘        │
       │                 │                          │
       │               ┌─┴─┐                        │
       │               │GND│                        │
       │               └───┘                        │
       │                                            │
       │                                            │
       ▼                                            ▼
    [10kΩ]                                    ┌─────────┐
    Pull-up                                   │  D26    │────┐
    (Optional,                                │  D27    │────┤
    ESP32 has                                 └─────────┘    │
    internal)                                                │
                                                             │
                                    ┌────────────────────────┴──────┐
                                    │   4-CHANNEL RELAY MODULE      │
                                    │                                │
                                    │  VCC  GND  IN1  IN2  IN3  IN4 │
                                    │   │    │    │    │    │    │  │
                                    └───┼────┼────┼────┼────┼────┼──┘
                                        │    │    │    │    │    │
                                        │    │    │    │    │    │
                                       5V   GND  D25  D33  D26  D27
                                        │    │
                                        │    │
                                    ┌───┴────┴───┐
                                    │ 5V POWER   │
                                    │  SUPPLY    │
                                    └────────────┘


                                RELAY OUTPUT WIRING
                                ===================

    Each relay has: COM (Common), NO (Normally Open), NC (Normally Closed)
    We use COM and NO for switching pump power

    Relay 1 (IN1 ← D25)          Relay 2 (IN2 ← D33)
    ┌───────────┐                ┌───────────┐
    │    COM────┼───┐            │    COM────┼───┐
    │    NO ────┼─┐ │            │    NO ────┼─┐ │
    │    NC     │ │ │            │    NC     │ │ │
    └───────────┘ │ │            └───────────┘ │ │
                  │ │                          │ │
                  ▼ ▼                          ▼ ▼
              ┌────────┐                   ┌────────┐
              │ Pump 1 │                   │ Pump 2 │
              │ 12V DC │                   │ 12V DC │
              └───┬────┘                   └───┬────┘
                  │                            │
              [Chemical 1]               [Chemical 2]
                  │                            │
                 Pool                         Pool


    Relay 3 (IN3 ← D26)          Relay 4 (IN4 ← D27)
    ┌───────────┐                ┌───────────┐
    │    COM────┼───┐            │    COM────┼───┐
    │    NO ────┼─┐ │            │    NO ────┼─┐ │
    │    NC     │ │ │            │    NC     │ │ │
    └───────────┘ │ │            └───────────┘ │ │
                  │ │                          │ │
                  ▼ ▼                          ▼ ▼
              ┌────────┐                   ┌────────┐
              │ Pump 3 │                   │ Pump 4 │
              │ 12V DC │                   │ 12V DC │
              └───┬────┘                   └───┬────┘
                  │                            │
              [Chemical 3]               [Chemical 4]
                  │                            │
                 Pool                         Pool


                            PUMP POWER WIRING
                            =================

    Option 1: Individual Power (Recommended)
    ─────────────────────────────────────────
    
    12V DC Power Supply
         │
         ├──[Fuse]──► Relay 1 COM ──NO──► Pump 1 (+) ──► GND
         ├──[Fuse]──► Relay 2 COM ──NO──► Pump 2 (+) ──► GND
         ├──[Fuse]──► Relay 3 COM ──NO──► Pump 3 (+) ──► GND
         └──[Fuse]──► Relay 4 COM ──NO──► Pump 4 (+) ──► GND


    Option 2: Shared Power
    ──────────────────────
    
    12V DC Power Supply (+)
         │
         ├──► Relay 1 COM ──NO──► Pump 1 (+)
         │                         Pump 1 (-) ──┐
         ├──► Relay 2 COM ──NO──► Pump 2 (+)   │
         │                         Pump 2 (-) ──┤
         ├──► Relay 3 COM ──NO──► Pump 3 (+)   ├──► Power Supply (-)
         │                         Pump 3 (-) ──┤       (GND)
         └──► Relay 4 COM ──NO──► Pump 4 (+)   │
                                   Pump 4 (-) ──┘


                        COMPLETE SYSTEM OVERVIEW
                        ========================

    ┌──────────────┐         WiFi          ┌──────────────┐
    │    ESP32     │◄────────────────────►│    Router    │
    │  + Relays    │                       └──────┬───────┘
    │  + Pumps     │                              │
    └──────────────┘                              │
                                                  │
                                         ┌────────▼────────┐
                                         │  Cloudflare     │
                                         │  Tunnel         │
                                         └────────┬────────┘
                                                  │
                                         ┌────────▼────────┐
                                         │ Flask Server    │
                                         │ localhost:5000  │
                                         │                 │
                                         │ dispenser_      │
                                         │ config.json     │
                                         └─────────────────┘


                            POWER REQUIREMENTS
                            ==================

    Component           Voltage    Current     Power
    ─────────────────────────────────────────────────
    ESP32               5V         500mA       2.5W
    Relay Module        5V         200mA       1W
    LED                 3.3V       20mA        0.066W
    Pump (each)         12V        500mA       6W
    ─────────────────────────────────────────────────
    Total (all on)      5V/12V     1.2A/2A     ~28W


    Recommended Power Supplies:
    - 5V 2A for ESP32 + Relay module
    - 12V 3A for pumps (with headroom)


                        PIN ASSIGNMENT SUMMARY
                        ======================

    Function            Pin     Type        Notes
    ─────────────────────────────────────────────────────
    LED Indicator       GPIO16  OUTPUT      Via 220Ω resistor
    Config Button       GPIO17  INPUT       Active LOW, pulled up
    Relay 1 (Disp. 1)   GPIO25  OUTPUT      Chemical solution 1
    Relay 2 (Disp. 2)   GPIO33  OUTPUT      Chemical solution 2
    Relay 3 (Disp. 3)   GPIO26  OUTPUT      Chemical solution 3
    Relay 4 (Disp. 4)   GPIO27  OUTPUT      Chemical solution 4


                            SAFETY NOTES
                            ============

    ⚠️  IMPORTANT:
    1. Use waterproof enclosures for electronics
    2. Keep 12V pump circuit separate from ESP32
    3. Add fuses to all pump power lines
    4. Use proper wire gauge for current loads
    5. Ground all metal enclosures
    6. Label all chemical containers clearly
    7. Install emergency shutoff switch
    8. Test with water before using chemicals
    9. Monitor first operation cycles
    10. Follow local electrical codes


                        RECOMMENDED COMPONENTS
                        ======================

    • ESP32: ESP32-DevKitC V4 or similar
    • Relay: SRD-05VDC-SL-C (5V, 10A)
    • Pumps: Peristaltic pumps (chemical resistant)
    • Tubing: Chemical-grade silicone or PTFE
    • Enclosure: IP65+ rated weatherproof box
    • Power: Mean Well LRS-35-5 (5V 7A) + LRS-50-12 (12V 4.2A)
    • Fuses: Automotive blade fuses 1A-2A
    • Connectors: Waterproof connectors for outdoor use


                            BUILD CHECKLIST
                            ===============

    Hardware Assembly:
    □ ESP32 mounted securely in enclosure
    □ Relay module mounted and connected
    □ LED and resistor soldered and connected
    □ Button wired with proper pull-up
    □ All GPIO connections verified
    □ Power supplies installed
    □ Pumps connected to relays
    □ Chemical tubing connected to pumps
    □ All connections insulated and protected
    □ Enclosure sealed and waterproof

    Software:
    □ Arduino IDE installed
    □ ESP32 board support added
    □ Required libraries installed
    □ Firmware uploaded successfully
    □ WiFi configured and tested
    □ API URL updated in firmware
    □ Server running and accessible
    □ Cloudflare tunnel configured
    □ API endpoints tested

    Testing:
    □ Power-on test successful
    □ LED indicators working
    □ Button functions verified
    □ WiFi connection stable
    □ API polling working
    □ All relays activate correctly
    □ Pump operation verified (with water)
    □ Flow rates calibrated
    □ Full cycle test completed
    □ Safety features tested


    For detailed instructions, see:
    - DISPENSER_SETUP.md
    - CLOUDFLARE_TUNNEL_SETUP.md
    - DISPENSER_README.md
```
